# Конспект по SQL

# JOIN

JOIN используется для объединения строк из двух или более таблиц на основе связанного столбца.

#### 1. INNER JOIN
Возвращает только те строки, у которых есть совпадения в обеих таблицах.

```sql
SELECT users.id, users.name, orders.id, orders.amount
FROM users
INNER JOIN orders ON users.id = orders.user_id;
```
#### 2. LEFT JOIN
Возвращает все строки из левой таблицы, даже если в правой таблице нет совпадений.
Несовпадающие значения будут NULL.
```sql
SELECT users.id, users.name, orders.id, orders.amount
FROM users
LEFT JOIN orders ON users.id = orders.user_id;
```

#### 3. RIGHT JOIN
Аналогично LEFT JOIN, но возвращает все строки из правой таблицы.
```sql
SELECT users.id, users.name, orders.id, orders.amount
FROM users
RIGHT JOIN orders ON users.id = orders.user_id;
```

#### 4. FULL JOIN
Возвращает все строки, если есть совпадения в любой из таблиц.
Несовпадения дополняются NULL.
```sql
SELECT users.id, users.name, orders.id, orders.amount
FROM users
FULL JOIN orders ON users.id = orders.user_id;
```

# Индексы в SQL

Индекс — это структура данных, которая ускоряет поиск строк в таблице по определённым столбцам.  
Наиболее распространённый тип индекса в реляционных СУБД — **B-TREE**.

## 1. Как работает B-TREE индекс?

- **B-TREE (Balanced Tree)** — это сбалансированное дерево, где:
    - данные упорядочены;
    - каждый узел хранит ссылки на дочерние узлы;
    - глубина дерева всегда минимальна (сбалансированность).

Принцип работы:
1. Запрос идёт сверху (корень).
2. СУБД сравнивает ключ и спускается в нужную ветку.
3. Находит листовой узел с указателем на строку в таблице.
4. Благодаря балансировке глубина дерева мала, и поиск работает быстро.

### 2. B-TREE balanced vs Binary Tree

| Характеристика         | Binary Tree                     | B-TREE (Balanced Tree) |
|-------------------------|----------------------------------|-------------------------|
| Кол-во ключей в узле   | 1 ключ                          | Несколько ключей        |
| Сбалансированность     | Может быть несбалансированным   | Всегда сбалансирован    |
| Высота дерева          | Может сильно вырасти            | Минимальная возможная   |
| Эффективность поиска   | От `O(log n)` до `O(n)`         | Всегда `O(log n)`       |
| Использование в БД     | Практически не используется     | Основной индекс в SQL   |

Итого: **B-TREE гарантирует равномерный доступ к данным**, а бинарное дерево — нет.

# Нормализация и денормализация в SQL

## 1. Что такое нормализация?
Нормализация — это процесс организации данных в базе, чтобы:
- убрать избыточность (дублирование),
- минимизировать аномалии при изменении данных,
- обеспечить целостность.

---

## 2. Третья нормальная форма (3НФ)

Чтобы таблица соответствовала **3НФ**, она должна удовлетворять условиям:

1. **Первая нормальная форма (1НФ)**
    - Нет дублирующихся строк
    - Все атрибуты атомарны
    - Нет повторяющихся атрибутов с одинковым смыслом

2. **Вторая нормальная форма (2НФ)**
    - Соответствует 1НФ.
    - Есть первичный ключ
    - Все неключевые атрибуты функционально зависят от ключа целиком, но не от его части

3. **Третья нормальная форма (3НФ)**
    - Соответствует 2НФ.
    - Нет **транзитивных зависимостей**:  
      неключевые атрибуты зависят только от первичного ключа, а не друг от друга.  
